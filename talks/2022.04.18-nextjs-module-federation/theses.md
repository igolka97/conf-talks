## Название доклада

Как я вляпался в микрофронтенды с NextJS и Module Federation

## Описание

С конца 2020 мы использовали Module Federation с десятком NextJS приложений. Каждое приложение подтягивало общие Navbar и Sidebar с меню и работало прекрасно. Но оставалась одна маленькая проблема - переход между NextJS приложениями осуществлялся с перезагрузкой страницы. Хоть и мелочь, но все-таки не приятно.

С начала 2021 года я все ждал, пока NextJS начнет из коробки поддерживать module federation. Ждал когда это появится в 11 версии, потом ждал 12-ую. И все это время как-то удавалось руководство "кормить завтраками". Но в начале 2022 терпение лопнуло и было принято решение начать собственную разработку в этом направлении.

Павел расскажет про все проблемы, с которыми он столкнулся и решал, когда собирал true-SPA приложение, собирающееся в браузере клиента из нескольких NextJS приложений.

Я знал, что это сложно и много подводных камней. Но с выходом пакета от Зака Джексона @module-federation/nextjs-mf, я оптимистично планировал за пару недель его проинтегрировать и обновить все наши приложения. Но, как всегда, задача начинает распухать и покрываться новыми подробностями и проблемами по ходу пьесы.

Рассказ будет про
- рефакторинг @module-federation/nextjs-mf
- подключение собственного ui/kit и борьбу с разными версиями
- распиливанием лейаута на AppLayout и FederatedLayout
- перенос меню из федерации в ui/kit в угоду отказоустойчивости
- починку загрузки NextJS картинок с федеративного контейнера
- починку wildcard роутов
- прикручивание общей шины, для общения между приложениями
- про разработкой useEventState хука
- про шаринг доступных роутов между приложениями
- про подгрузку нового меню, когда клиент бесшовно переходит в другое приложение
- про "Shared module is not available for eager consumption" и как он выбил меня из колеи на неделю
- немного поделюсь болью дебага вебпака в рантайме с контейнерами
- и многое многое другое, что походу пьесы выплывает, пока я проваливаюсь в кроличью нору, доводя наше решение до продакшена.

## Детальный план
